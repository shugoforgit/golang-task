# åšå®¢ç³»ç»Ÿ API

åŸºäº Go + Gin + GORM + MySQL çš„åšå®¢ç³»ç»Ÿåç«¯ APIï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œç™»å½•ã€æ–‡ç« ç®¡ç†ã€è¯„è®ºåŠŸèƒ½ï¼Œä½¿ç”¨ JWT è¿›è¡Œèº«ä»½è®¤è¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” JWT èº«ä»½è®¤è¯
- ğŸ‘¤ ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- ğŸ“ æ–‡ç«  CRUD æ“ä½œ
- ğŸ’¬ è¯„è®ºåŠŸèƒ½
- ğŸ“Š ç”¨æˆ·æ–‡ç« ç»Ÿè®¡
- ğŸ“ ç»Ÿä¸€æ—¥å¿—è®°å½•
- ğŸ¯ ç»Ÿä¸€å“åº”æ ¼å¼
- ğŸ”’ æƒé™æ§åˆ¶

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.22.2
- **Webæ¡†æ¶**: Gin
- **ORM**: GORM
- **æ•°æ®åº“**: MySQL
- **è®¤è¯**: JWT
- **å¯†ç åŠ å¯†**: bcrypt

## ç¯å¢ƒè¦æ±‚

- Go 1.22.2 æˆ–æ›´é«˜ç‰ˆæœ¬
- MySQL 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Git

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd task-4
```

### 2. å®‰è£…ä¾èµ–

```bash
go mod download
```

### 3. é…ç½®æ•°æ®åº“

#### 3.1 åˆ›å»ºæ•°æ®åº“

```sql
CREATE DATABASE blog_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 3.2 é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `main.go` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼š

```go
var dsn = "ç”¨æˆ·å:å¯†ç @tcp(127.0.0.1:3306)/blog_db?charset=utf8mb4&parseTime=True&loc=Local"
```

è¯·å°† `ç”¨æˆ·å` å’Œ `å¯†ç ` æ›¿æ¢ä¸ºæ‚¨çš„ MySQL ç”¨æˆ·åå’Œå¯†ç ã€‚

### 4. è¿è¡Œé¡¹ç›®

```bash
# ç¼–è¯‘å¹¶è¿è¡Œ
go run .

# æˆ–è€…å…ˆç¼–è¯‘å†è¿è¡Œ
go build -o main .
./main
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨ã€‚

## é¡¹ç›®ç»“æ„

```
task-4/
â”œâ”€â”€ main.go              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod               # Go æ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum               # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ logger/              # æ—¥å¿—æ¨¡å—
â”‚   â””â”€â”€ logger.go        # æ—¥å¿—å·¥å…·
â”œâ”€â”€ response/            # å“åº”å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ response.go      # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â””â”€â”€ errors.go        # é”™è¯¯å¸¸é‡å®šä¹‰
â””â”€â”€ log/                 # æ—¥å¿—æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ info.log         # ä¿¡æ¯æ—¥å¿—
    â””â”€â”€ error.log        # é”™è¯¯æ—¥å¿—
```

## API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8080`
- **Content-Type**: `application/json`
- **è®¤è¯æ–¹å¼**: JWT Token (åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: <token>`)

### ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": {}
}
```

### 1. ç”¨æˆ·æ³¨å†Œ

**æ¥å£**: `POST /register`

**è¯·æ±‚ä½“**:
```json
{
  "username": "testuser",
  "password": "password123",
  "email": "test@example.com"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æ³¨å†ŒæˆåŠŸ"
}
```

### 2. ç”¨æˆ·ç™»å½•

**æ¥å£**: `POST /login`

**è¯·æ±‚ä½“**:
```json
{
  "username": "testuser",
  "password": "password123"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 3. åˆ›å»ºæ–‡ç« 

**æ¥å£**: `POST /auth/create-post`

**è®¤è¯**: éœ€è¦ JWT Token

**è¯·æ±‚ä½“**:
```json
{
  "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
  "content": "è¿™æ˜¯æ–‡ç« å†…å®¹..."
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "åˆ›å»ºæˆåŠŸ"
}
```

### 4. è·å–æ‰€æœ‰æ–‡ç« 

**æ¥å£**: `GET /posts`

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
      "content": "è¿™æ˜¯æ–‡ç« å†…å®¹...",
      "user_id": 1,
      "comment_status": "æ— è¯„è®º",
      "created_at": "2024-01-01T00:00:00Z",
      "updated_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

### 5. è·å–å•ä¸ªæ–‡ç« 

**æ¥å£**: `GET /posts/:id`

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
    "content": "è¿™æ˜¯æ–‡ç« å†…å®¹...",
    "user_id": 1,
    "comment_status": "æ— è¯„è®º",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
}
```

### 6. æ›´æ–°æ–‡ç« 

**æ¥å£**: `POST /auth/update-post`

**è®¤è¯**: éœ€è¦ JWT Token

**è¯·æ±‚ä½“**:
```json
{
  "id": 1,
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹..."
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ"
}
```

### 7. åˆ é™¤æ–‡ç« 

**æ¥å£**: `POST /auth/delete-post`

**è®¤è¯**: éœ€è¦ JWT Token

**è¯·æ±‚ä½“**:
```json
{
  "id": 1
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "åˆ é™¤æˆåŠŸ"
}
```

### 8. åˆ›å»ºè¯„è®º

**æ¥å£**: `POST /auth/create-comment`

**è®¤è¯**: éœ€è¦ JWT Token

**è¯·æ±‚ä½“**:
```json
{
  "post_id": 1,
  "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "msg": "åˆ›å»ºæˆåŠŸ"
}
```

### 9. è·å–æ–‡ç« è¯„è®º

**æ¥å£**: `GET /comments/:post_id`

**å“åº”**:
```json
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "user_id": 1,
      "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º",
      "post_id": 1,
      "created_at": "2024-01-01T00:00:00Z",
      "updated_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ/æœªç™»å½• |
| 403 | æ— æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 501 | æ•°æ®åº“é”™è¯¯ |

## æ•°æ®åº“è¡¨ç»“æ„

### users è¡¨
- `id`: ä¸»é”®
- `username`: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `password`: å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- `email`: é‚®ç®±
- `post_count`: æ–‡ç« æ•°é‡
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### posts è¡¨
- `id`: ä¸»é”®
- `title`: æ–‡ç« æ ‡é¢˜
- `content`: æ–‡ç« å†…å®¹
- `user_id`: ä½œè€…IDï¼ˆå¤–é”®ï¼‰
- `comment_status`: è¯„è®ºçŠ¶æ€
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### comments è¡¨
- `id`: ä¸»é”®
- `user_id`: è¯„è®ºè€…IDï¼ˆå¤–é”®ï¼‰
- `content`: è¯„è®ºå†…å®¹
- `post_id`: æ–‡ç« IDï¼ˆå¤–é”®ï¼Œçº§è”åˆ é™¤ï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

## æ—¥å¿—ç³»ç»Ÿ

é¡¹ç›®ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—ç³»ç»Ÿï¼Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨ `log/` ç›®å½•ä¸‹ï¼š

- `info.log`: ä¿¡æ¯æ—¥å¿—
- `error.log`: é”™è¯¯æ—¥å¿—

æ—¥å¿—æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ†å‰²ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ã€‚

## å®‰å…¨ç‰¹æ€§

1. **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç å“ˆå¸Œ
2. **JWT è®¤è¯**: åŸºäº JWT çš„èº«ä»½è®¤è¯
3. **æƒé™æ§åˆ¶**: ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ–‡ç« 
4. **å‚æ•°éªŒè¯**: ä¸¥æ ¼çš„è¯·æ±‚å‚æ•°éªŒè¯
5. **SQL æ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨ GORM å‚æ•°åŒ–æŸ¥è¯¢

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„é”™è¯¯ç 

åœ¨ `response/errors.go` ä¸­æ·»åŠ æ–°çš„é”™è¯¯å¸¸é‡ï¼š

```go
const (
    CodeNewError = 502
)

var (
    ErrNewError = errors.New("æ–°é”™è¯¯æè¿°")
)
```

### æ·»åŠ æ–°çš„å“åº”æ–¹æ³•

åœ¨ `response/response.go` ä¸­æ·»åŠ æ–°çš„å“åº”æ–¹æ³•ï¼š

```go
func (r *ResponseHandlerStruct) NewError(c *gin.Context, err error) {
    r.Error(c, CodeNewError, err)
}
```

## æ•…éšœæ’é™¤

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

- æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æƒé™

### 2. JWT è®¤è¯å¤±è´¥

- æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦åŒ…å« `Authorization` å­—æ®µ
- éªŒè¯ JWT Token æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤ Token æ˜¯å¦è¿‡æœŸ

### 3. å¤–é”®çº¦æŸé”™è¯¯

- ç¡®ä¿æ•°æ®åº“è¡¨å·²æ­£ç¡®åˆ›å»º
- æ£€æŸ¥å¤–é”®çº¦æŸæ˜¯å¦æ­£ç¡®è®¾ç½®
- éªŒè¯çº§è”åˆ é™¤æ˜¯å¦ç”Ÿæ•ˆ

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼ 